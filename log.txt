# Poma 项目开发日志

## 2025-08-25 - 项目启动

### 14:30 - 需求分析和产品定位

### 产品定位确定
- 定位：播客版的 Kindle Highlights，不做播放器，而是做现有平台的"书签层"
- 目标场景：跑步、通勤等移动场景的 casual listening
- 核心用户：Spotify + Android Pixel 7a + Pixel Buds Pro 用户

### 核心功能设计
- Pixel Buds Pro 长按手势触发语音笔记
- Pixel 手机 Quick Tap（背部双击）作为备选触发方式
- Spotify API 集成获取播放状态和时间戳
- 语音转文字 + AI 总结功能

### 技术栈选择
- 移动端：Android 原生（Kotlin + Jetpack Compose）
- 后端：FastAPI (Python)
- 数据库：PostgreSQL + Redis
- AI 服务：Whisper API + GPT-4

### 开发路线图
- Phase 1：Spotify 授权 → 播放状态获取 → 语音笔记 → 基础回顾界面
- Phase 2：AI 上下文捕获 → 内容总结 → 周期性回顾
- Phase 3：多平台支持 → 可视化统计

### 15:45 - 项目结构搭建完成
- 创建完整的前后端分离架构
- Android 客户端：Kotlin + Jetpack Compose + Navigation
- 后端：FastAPI + PostgreSQL + Redis
- 关键 Android 组件：
  - QuickBookmarkTileService：Quick Settings 快捷开关
  - MediaListenerService：监听播放状态
  - 三个主要页面：HomeScreen, BookmarksScreen, SettingsScreen
- 后端 API 结构：
  - /auth：用户认证
  - /spotify：Spotify 集成
  - /bookmarks：书签管理
- 硬件集成支持：Quick Tap、Pixel Buds Pro 长按手势

### 16:15 - 设备信息更正
- 耳机设备：Pixel Buds Pro（非 Pro 2）
- 已更新所有相关文档和代码注释

### 16:20 - Android 架构说明和登录方式设计
- 创建详细的 Android 架构文档 (MVVM + Clean Architecture)
- 确定登录认证方案：
  - 主要方式：Google 登录 (适合 Pixel 用户) + 邮箱密码登录
  - 扩展方式：Spotify 直接登录 (未来)
  - 技术实现：JWT Token + EncryptedSharedPreferences
  - 安全设计：HTTPS + Certificate Pinning

### 16:25 - Google 登录设置评估
- Google 登录设置时间评估：约30-60分钟
- 主要步骤简单，无复杂配置

### 16:40 - Google 登录代码实现完成
- Android 端：
  - 添加 Google Sign-In 依赖和插件
  - 创建 LoginScreen 登录界面
  - 实现 AuthViewModel 状态管理
  - 更新导航从登录页面开始
- 后端：
  - 添加 google-auth 依赖
  - 实现 /api/v1/auth/google 登录接口
  - Google ID Token 验证逻辑
  - JWT Token 生成和返回
- 配置文件：
  - google-services.json 模板
  - 环境变量配置示例
- 下一步：需要 Google Cloud Console 配置才能测试

### 16:45 - 开始 Google Cloud Console 配置
- 准备配置 Google OAuth 2.0 凭据
- 项目名称：POMA（大写，无影响）
- 注意：不要启用已废弃的 Google+ API
- 直接配置 OAuth 2.0 凭据即可
- 跳过 API 启用，直接配置 OAuth 同意屏幕
- 创建完整 Android 项目结构和 gradlew 文件
- 修复 gradle-wrapper.jar 缺失问题
- 成功获取 SHA-1 指纹：22:B0:77:DC:81:7B:C7:FF:B6:2D:30:E1:F2:D3:0A:21:2F:A0:23:82
- 清理错误的 {app 目录，项目结构现已正常
- 开始创建 Google OAuth 客户端（英文界面指导）
- 更新完整的 google-signin-setup.md 文档，包含详细的英文界面操作步骤
- 用户询问 keytool 命令获取指纹的替代方法
- 用户下载了错误的 JSON 文件（Web 应用凭据而非 Android google-services.json）
- 手动创建了正确格式的 google-services.json 文件
- 更新 Android 代码和后端环境变量，配置完成
- 用户询问 Firebase 的作用和用途
- 确认不需要额外创建 Firebase 项目，现有配置已足够
- 用户询问后端是否需要 Python 虚拟环境
- 用户询问 uvicorn 命令的作用
- 成功创建 Python 虚拟环境并安装依赖
- 后端服务器成功启动在 http://localhost:8001
- API 测试通过：根路径和健康检查接口正常
- 创建一键启动后端的脚本文件
